service: owl
plugins:
  - serverless-cloudformation-sub-variables
  # - serverless-esbuild
  # - serverless-cloudside-plugin

custom:
  stage: ${opt:stage, 'dev'}

  Domains:
    default: ${self:custom.stage}.serverlessowl.dev
    production: serverlessowl.dev
  Domain: ${self:custom.Domains.${self:custom.stage}, self:custom.Domains.default}

  devExperiences:
    default: cloud
    local: local
  devExperience: ${self:custom.devExperiences.${self:custom.stage}, self:custom.devExperiences.default}

provider:
  name: aws
  timeout: 30
  memorySize: 1024
  runtime: nodejs12.x
  profile: personal
  region: eu-west-1
  stage: ${self:custom.stage}

resources:
  # Cognito Resources
  - ${file(./infrastructure/authentication/UserPool.yml)}
  - ${file(./infrastructure/authentication/UserPoolClient.yml)}
  - ${file(./infrastructure/authentication/HostedUi.yml)}
  - ${file(./infrastructure/authentication/IdentityPool.yml)}
  - ${file(./infrastructure/authentication/CognitoAuthorizedRole.yml)}
  - ${file(./infrastructure/authentication/IdentityRoleMapping.yml)}

  # Database Resources
  # - ${file(./infrastructure/database/Dynamo.yml)}

  # Web Resources
  - ${file(./infrastructure/web/Distribution.${self:custom.devExperience}.yml), ''}
  - ${file(./infrastructure/web/RecordSets.${self:custom.devExperience}.yml), ''}
  - ${file(./infrastructure/web/Bucket.${self:custom.devExperience}.yml), ''}
